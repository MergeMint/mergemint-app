#:schema node_modules/wrangler/config-schema.json

name = "mergemint"
main = ".open-next/worker.js"
compatibility_date = "2024-12-01"
compatibility_flags = ["nodejs_compat"]

# Observability configuration
[observability]
[observability.logs]
enabled = true
head_sampling_rate = 1
invocation_logs = true
persist = true

# Production routes (default environment)
routes = [
  { pattern = "mergemint.dev/*", zone_name = "mergemint.dev" },
  { pattern = "www.mergemint.dev/*", zone_name = "mergemint.dev" }
]

# Static assets configuration
assets = { directory = ".open-next/assets", binding = "ASSETS" }

# Cron triggers - process 1 unprocessed PR every minute
# This processes ~60 PRs/hour, ~1440 PRs/day
# Each invocation only makes 1 Claude API call, avoiding timeout
[triggers]
crons = ["* * * * *"]

# Environment variables
[vars]
MAILGUN_DOMAIN = "mg.mergemint.dev"
MAILGUN_FROM = "MergeMint <hello@mg.mergemint.dev>"
MAILGUN_API_URL = "https://api.eu.mailgun.net/v3"
NEXT_PUBLIC_SUPABASE_URL = "https://gptaepnnnvvwsdmphvqq.supabase.co"
NEXT_PUBLIC_SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdwdGFlcG5ubnZ2d3NkbXBodnFxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUyMDE4NzksImV4cCI6MjA4MDc3Nzg3OX0.UaZPMyOhhirKa9EXrekonBES2ZI79WMv9HWzrYuvBaA"
NEXT_PUBLIC_GITHUB_APP_SLUG = "mergemint-connector"
NEXT_PUBLIC_SITE_URL = "https://mergemint.dev"
NEXT_PUBLIC_PRODUCT_NAME = "MergeMint"
NEXT_PUBLIC_SITE_TITLE = "MergeMint - AI-Powered PR Scoring & Developer Recognition Platform"
NEXT_PUBLIC_SITE_DESCRIPTION = "Turn merged PRs into developer recognition with AI. MergeMint automatically evaluates pull requests using Claude AI, scores contributions by severity and impact, and powers fair bug bounty programs and performance reviews. Open source and self-hostable."

# ============================================================
# Staging Environment
# ============================================================
[env.staging]
name = "mergemint-staging"
routes = [
  { pattern = "staging.mergemint.dev/*", zone_name = "mergemint.dev" }
]

[env.staging.vars]
MAILGUN_DOMAIN = "mg.mergemint.dev"
MAILGUN_FROM = "MergeMint <hello@mg.mergemint.dev>"
MAILGUN_API_URL = "https://api.eu.mailgun.net/v3"
NEXT_PUBLIC_SUPABASE_URL = "https://gptaepnnnvvwsdmphvqq.supabase.co"
NEXT_PUBLIC_SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdwdGFlcG5ubnZ2d3NkbXBodnFxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUyMDE4NzksImV4cCI6MjA4MDc3Nzg3OX0.UaZPMyOhhirKa9EXrekonBES2ZI79WMv9HWzrYuvBaA"
NEXT_PUBLIC_GITHUB_APP_SLUG = "mergemint-connector"
NEXT_PUBLIC_SITE_URL = "https://staging.mergemint.dev"
NEXT_PUBLIC_PRODUCT_NAME = "MergeMint"
NEXT_PUBLIC_SITE_TITLE = "MergeMint - AI-Powered PR Scoring & Developer Recognition Platform"
NEXT_PUBLIC_SITE_DESCRIPTION = "Turn merged PRs into developer recognition with AI. MergeMint automatically evaluates pull requests using Claude AI, scores contributions by severity and impact, and powers fair bug bounty programs and performance reviews. Open source and self-hostable."

# ============================================================
# Production Environment (explicit, same as default)
# ============================================================
[env.production]
name = "mergemint"
routes = [
  { pattern = "mergemint.dev/*", zone_name = "mergemint.dev" },
  { pattern = "www.mergemint.dev/*", zone_name = "mergemint.dev" }
]

[env.production.vars]
MAILGUN_DOMAIN = "mg.mergemint.dev"
MAILGUN_FROM = "MergeMint <hello@mg.mergemint.dev>"
MAILGUN_API_URL = "https://api.eu.mailgun.net/v3"
NEXT_PUBLIC_SUPABASE_URL = "https://gptaepnnnvvwsdmphvqq.supabase.co"
NEXT_PUBLIC_SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdwdGFlcG5ubnZ2d3NkbXBodnFxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUyMDE4NzksImV4cCI6MjA4MDc3Nzg3OX0.UaZPMyOhhirKa9EXrekonBES2ZI79WMv9HWzrYuvBaA"
NEXT_PUBLIC_GITHUB_APP_SLUG = "mergemint-connector"
NEXT_PUBLIC_SITE_URL = "https://mergemint.dev"
NEXT_PUBLIC_PRODUCT_NAME = "MergeMint"
NEXT_PUBLIC_SITE_TITLE = "MergeMint - AI-Powered PR Scoring & Developer Recognition Platform"
NEXT_PUBLIC_SITE_DESCRIPTION = "Turn merged PRs into developer recognition with AI. MergeMint automatically evaluates pull requests using Claude AI, scores contributions by severity and impact, and powers fair bug bounty programs and performance reviews. Open source and self-hostable."

